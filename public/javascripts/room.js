// Generated by CoffeeScript 1.3.3
var chat, displayChat, langs, send, socket, updateLoginUsers, user;

user = $("#username").val();

langs = ['ja', 'en', 'zh-CHS'];

send = {
  ja: '送信',
  en: 'send',
  'zh-CHS': '传输'
};

$(document).ready(function() {
  $('#tab').tabs();
  $('a.lang').click(function() {
    var lang;
    lang = $(this).attr("name");
    $("#from").val(lang);
    $("#send").val(send[lang]);
    return false;
  });
  return false;
});

socket = null;

$(function() {
  socket = io.connect();
  socket.emit('login', user);
  socket.on('res', function(from, msgs) {
    return displayChat(from, msgs);
  });
  socket.on('updateLoginUsers', function(users) {
    console.log("updateLoginUsers users= " + users);
    return updateLoginUsers(users);
  });
  $('form').submit(function(e) {
    chat();
    return false;
  });
  return false;
});

updateLoginUsers = function(users) {
  var i, lang, _i, _len, _results;
  console.log(users);
  _results = [];
  for (_i = 0, _len = langs.length; _i < _len; _i++) {
    lang = langs[_i];
    $("div#" + lang + ".loginUsers p span").remove();
    _results.push((function() {
      var _j, _len1, _results1;
      _results1 = [];
      for (_j = 0, _len1 = users.length; _j < _len1; _j++) {
        i = users[_j];
        _results1.push($("div#" + lang + ".loginUsers p").append($('<span>').text(users[i])));
      }
      return _results1;
    })());
  }
  return _results;
};

chat = function() {
  var from_lang, msg;
  msg = $('input.chatText').val();
  from_lang = $("#from").val();
  $('input.chatText').val('').focus();
  socket.emit('chat', user, msg, from_lang);
  $('div,chatDiv').animate({
    scrollTop: 2000000
  }, 'fast');
  return false;
};

displayChat = function(from, msgs) {
  var chatDom, msg, nameDom, trDom, _id, _results, _val;
  _results = [];
  for (msg in msgs) {
    _id = msgs[msg]['lang'];
    _val = msgs[msg]['value'];
    nameDom = $('<p>').addClass('name').text("" + from + " : ");
    trDom = $('<tr>');
    trDom.append($('<td>').addClass('nameTd').append(nameDom));
    chatDom = $('<p>').addClass('chat').text(_val);
    trDom.append($('<td>').addClass('chatTd').append(chatDom));
    _results.push($("table#" + _id + "_tbl").append(trDom));
  }
  return _results;
};
